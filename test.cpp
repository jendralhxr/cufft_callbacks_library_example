#include "libmain.h"

#include <complex>
#include <iostream>
#include <vector>

int main(){
    const int N=8;

    std::vector<std::complex<float>> vec = {{0.6010,0.0278},{0.4165,0.5814},{0.3336,0.0363},{0.3637,0.9643},{0.8578,0.0192},{0.3967,0.8055},{0.9033,0.5131},{0.1266,0.6511},
         {0.9806,0.2126},{0.8962,0.3712},{0.5349,0.0123},{0.9092,0.8865},{0.7191,0.4035},{0.5147,0.3210},{0.5784,0.6910},{0.4507,0.4220},
         {0.0655,0.5497},{0.6755,0.6105},{0.3988,0.9787},{0.9676,0.1425},{0.4692,0.3353},{0.7831,0.4784},{0.4792,0.6265},{0.2491,0.4128},
         {0.2864,0.3410},{0.5232,0.5567},{0.2308,0.6244},{0.5137,0.6484},{0.9048,0.0198},{0.5770,0.8173},{0.7387,0.8523},{0.7664,0.8045},
         {0.7509,0.4105},{0.7896,0.8966},{0.7917,0.1654},{0.6353,0.7449},{0.4436,0.6808},{0.5207,0.4341},{0.5827,0.3657},{0.8104,0.6913},
         {0.1583,0.3712},{0.0536,0.5775},{0.8657,0.3766},{0.4391,0.6982},{0.6636,0.8738},{0.8891,0.3434},{0.9730,0.2184},{0.7821,0.3054},
         {0.3543,0.6450},{0.2908,0.9941},{0.7331,0.2522},{0.5970,0.9594},{0.3954,0.5277},{0.8040,0.2986},{0.6659,0.3688},{0.1673,0.2990},
         {0.9675,0.3636},{0.5143,0.3670},{0.9644,0.4711},{0.2323,0.9623},{0.3592,0.8567},{0.0438,0.6108},{0.2578,0.3815},{0.2802,0.1480}};

    const std::vector<std::complex<float>> ones = {{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},
         {1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000},{1.0000,0.0000}};

    auto vecorig = vec;

    std::cout<<"Generating plan anew for each kernel..."<<std::endl;
    for(int i=0;i<20;i++){
        std::cout<<"\t"<<i<<std::endl;
        scaled_ifft_inplace(vec, ones, 8, true);
        vec = vecorig;
    }

    std::cout<<"Trying to use pregenerated plan..."<<std::endl;
    create_fft_plan(8);
    for(int i=0;i<20;i++){
        std::cout<<"\t"<<i<<std::endl;
        scaled_ifft_inplace(vec, ones, 8, false);
        vec = vecorig;
    }
    destroy_fft_plan();

    for(int i=0;i<N;i++){
        for(int j=0;j<N;j++){
            std::cout<<vec[j*N+i].real()<<","<<vec[j*N+i].imag()<<"   ";
        }
        std::cout<<"\n";
    }
}
